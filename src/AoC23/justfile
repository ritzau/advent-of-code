# Advent of Code 2023 - TypeScript Solutions
# All commands use Nix for reproducible builds

# Get current system (e.g., x86_64-linux, aarch64-darwin)
system := `nix eval --impure --raw --expr 'builtins.currentSystem'`

# Build all solutions
build:
    nix build

# Run all solutions or a specific day (e.g., just run 1)
run DAY="":
    #!/usr/bin/env bash
    if [ -z "{{DAY}}" ]; then
        nix run
    else
        nix run . -- {{DAY}}
    fi

# Run a specific day and part (e.g., just run-part 1 1)
run-part DAY PART:
    #!/usr/bin/env bash
    day_padded=$(printf "%02d" {{DAY}})
    ts-node "AoC23E${day_padded}.ts" {{PART}}

# Run all checks (build + typecheck + format-check)
check:
    nix flake check

# Run type check only
typecheck:
    nix build .#checks.{{system}}.typecheck

# Check formatting without modifying files
format-check:
    nix build .#checks.{{system}}.format-check

# Format code (requires nix develop or prettier installed)
format:
    prettier --write "*.ts"

# Install dependencies
install:
    yarn install

# Watch mode - auto-reload on changes
watch:
    yarn watch

# Clean build artifacts and dependencies
clean:
    rm -rf node_modules dist result
